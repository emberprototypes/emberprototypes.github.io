<!doctype html><html lang="en"><head><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat"><title>Camera XY Calibration</title><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><style>body{font-family:Montserrat;text-align:center}button{font-family:Montserrat;text-align:center}#videoContainer{position:relative;margin:auto;width:500px;height:375px;border-style:double;overflow:hidden}#videoStream{width:500px;height:375px;background-color:#000}#crosshairOverlay{position:absolute;width:100px;height:100px;left:200px;top:137.5px}</style></head><body><a href="https://www.emberprototypes.com/products/cxc" target="_blank"><img src="../images/Black Logo.png" alt="Ember background" class="center" style="max-width:400px;min-width:400px"><br><hr style="width:500px;height:5px;background-color:#e6e6e6;border-width:0"><br></a><h2 style="font-weight:1000">Camera Assisted XY Offset Calibration</h2><a href="https://drive.google.com/file/d/1kBHQkrujYlfWvHdGmklLLmi-EM_ri_2X/view" target="_blank">Click here for user manual & troubleshooting</a><br><br><br><div id="videoContainer"><video autoplay="true" id="videoStream"></video><img id="crosshairOverlay" src="../images/Crosshair.png" alt="Image crosshair"></div><br><button onclick="zoomIn()">&nbsp;&nbsp;&nbsp;Zoom In&nbsp;&nbsp;</button>&nbsp;<button onclick="zoomOut()">Zoom Out</button><br><br><input style="width:200px" onclick="exposureHandler()" id="exposureSlider" type="range" min="0" max="20" value="10"><br><br><button id="startButton" onclick="startHandler()" style="font-size:larger">&nbsp;&nbsp;Start&nbsp;&nbsp;</button>&nbsp;&nbsp;<button id="backButton" onclick="backHandler()" style="font-size:larger" disabled="disabled">&nbsp;&nbsp;Back&nbsp;&nbsp;</button>&nbsp;&nbsp;<button id="resetButton" onclick="resetHandler()" style="font-size:larger" disabled="disabled">&nbsp;&nbsp;Reset&nbsp;&nbsp;</button><br><br><p id="textBox" style="font-size:smaller;border-style:double;max-width:600px;min-width:600px;min-height:150px;position:relative;margin:auto;padding-top:25px"></p><br><form><p style="font-weight:600">X0: <input type="number" name="x0" id="x0" step="0.01" value="" onchange="setTwoNumberDecimal(this)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y0: <input type="number" name="y0" id="y0" step="0.01" value="" onchange="setTwoNumberDecimal(this)"><br><br>X1: <input type="number" name="x1" id="x1" step="0.01" value="" onchange="setTwoNumberDecimal(this)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y1: <input type="number" name="y1" id="y1" step="0.01" value="" onchange="setTwoNumberDecimal(this)"><br><br>X2: <input type="number" name="x2" id="x2" step="0.01" value="" onchange="setTwoNumberDecimal(this)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y2: <input type="number" name="y2" id="y2" step="0.01" value="" onchange="setTwoNumberDecimal(this)"><br><br>X3: <input type="number" name="x3" id="x3" step="0.01" value="" onchange="setTwoNumberDecimal(this)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y3: <input type="number" name="y3" id="y3" step="0.01" value="" onchange="setTwoNumberDecimal(this)"><br><br>X4: <input type="number" name="x4" id="x4" step="0.01" value="" onchange="setTwoNumberDecimal(this)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y4: <input type="number" name="y4" id="y4" step="0.01" value="" onchange="setTwoNumberDecimal(this)"><br></p></form><form><br><hr style="width:500px;height:5px;background-color:#e6e6e6;border-width:0"><br><p style="font-weight:600">X: <input type="text" id="calibrationX" name="calibrationX" readonly="readonly">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y: <input type="text" id="calibrationY" name="calibrationY" readonly="readonly"><br><br><br></p></form><a style="font-size:smaller" href="mailto:info@emberprototypes.com">Ember Prototypes - 2023</a>
<script>
function findCamera(e){var t=null,n=document.querySelector("#videoStream");for(let a=0;a<e.length;a++){const o=e[a];if(debugOutput(o.label),debugOutput(o.deviceId),o.label.includes("HD Camera")&&!o.label.includes("FaceTime")){t=o.deviceId,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:t}}}).then(function(e){n.srcObject=e}).catch(function(e){debugOutput("Error streaming video")}),debugOutput("CXC camera connected!");break}}null==t&&(debugOutput("Could not find the CXC Camera",t),alert("Could not find the CXC Camera!"))}async function cameraConnect(){navigator.mediaDevices.getUserMedia&&(debugOutput("Attempting to get permissions, enumerate, and connect to CXC camera..."),await navigator.mediaDevices.getUserMedia({video:!0}),navigator.mediaDevices.enumerateDevices().then(findCamera).catch(function(e){debugOutput("Error enumerating or connecting to devices")}))}function debugOutput(e){console.log(e)}function calculateOffsets(){debugOutput("Calculating offsets...");var e=document.getElementById("x0").value,t=document.getElementById("x1").value,n=document.getElementById("x2").value,a=document.getElementById("x3").value,o=document.getElementById("x4").value,r=document.getElementById("y0").value,u=document.getElementById("y1").value,d=document.getElementById("y2").value,i=document.getElementById("y3").value,c=document.getElementById("y4").value,l=(e-t).toFixed(2),m=(e-n).toFixed(2),s=(e-a).toFixed(2),b=(e-o).toFixed(2),g=(r-u).toFixed(2),B=(r-d).toFixed(2),y=(r-i).toFixed(2),v=(r-c).toFixed(2),E=" / ",f=" / ",I=" / ";""==t&&(l="",g=""),""==n&&(m="",B="",E=""),""==a&&(s="",y="",f=""),""==o&&(b="",v="",I="");var h=l+E+m+f+s+I+b,x=g+E+B+f+y+I+v;document.getElementById("calibrationX").value=h,document.getElementById("calibrationY").value=x,debugOutput(h),debugOutput(x)}function zoomIn(){currentZoomValue<3&&(currentZoomValue+=.5),document.getElementById("videoStream").style.transform="scale("+currentZoomValue+")"}function zoomOut(){currentZoomValue>1&&(currentZoomValue-=.5),document.getElementById("videoStream").style.transform="scale("+currentZoomValue+")"}function exposureHandler(){var e=document.getElementById("exposureSlider").value/10;document.getElementById("videoStream").style.filter="brightness("+e+")"}function setTwoNumberDecimal(e){e.value=parseFloat(e.value).toFixed(2)}function startHandler(){0==currentState&&(document.getElementById("backButton").disabled=!1,document.getElementById("resetButton").disabled=!1,document.getElementById("startButton").innerHTML="Continue"),currentState++,stateHandler()}function backHandler(){currentState--,stateHandler()}function resetHandler(){currentState=0,stateHandler()}function stateHandler(){switch(currentState){case 0:document.getElementById("startButton").innerHTML="Start",document.getElementById("textBox").innerHTML="",document.getElementById("startButton").disabled=!1,document.getElementById("backButton").disabled=!0,document.getElementById("resetButton").disabled=!0;break;case 1:document.getElementById("textBox").innerHTML="You MUST clear existing machine offset values for calibration to be accurate.<br><br>You MUST home the machine AFTER any changes to machine offset values.<br><br>Order of operations is CRITICAL, follow instructions carefully.<br><br>Ensure your CXC is STABLE and does NOT MOVE during calibration.";break;case 2:document.getElementById("textBox").innerHTML="Clean nozzles - heat to 200C+ and wipe with brass/stainless brush.<br><br>Backup current calibration values and then set to zero.";break;case 3:document.getElementById("textBox").innerHTML="Home the machine.<br><br>Move the Z axis up to 30mm.";break;case 4:document.getElementById("textBox").innerHTML="Place the CXC on the bed and drive T0 until visible.<br><br>Rotate the lens to focus the camera and adjust exposure if required.";break;case 5:document.getElementById("textBox").innerHTML="Move T0 until centered in the crosshair.<br><br>Enter the absolute X and Y position into the fields below.";break;case 6:document.getElementById("textBox").innerHTML="Home T0 and move T1 to the position previously recorded.";break;case 7:document.getElementById("textBox").innerHTML="Move T1 until centered in the crosshair.<br><br>Enter the absolute X and Y position into the fields below.<br><br>Repeat for remaining extruders if any.",document.getElementById("startButton").disabled=!1,document.getElementById("calibrationX").value="",document.getElementById("calibrationY").value="";break;case 8:calculateOffsets(),document.getElementById("textBox").innerHTML="CALIBRATION COMPLETE!<br><br>Enter the offset values into your printer or slicer.<br><br>If you are having trouble calibrating, check our user manual for troubleshooting.",document.getElementById("startButton").disabled=!0,document.getElementById("backButton").disabled=!1,document.getElementById("resetButton").disabled=!1}}var currentZoomValue=1,currentState=0;cameraConnect();
</script>
</body></html>