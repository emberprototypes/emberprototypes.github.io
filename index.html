<!doctype html><html lang="en"><head><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat"><title>Camera XY Calibration</title><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><style>body{font-family:Montserrat;text-align:center}button{font-family:Montserrat;text-align:center}#videoContainer{position:relative;margin:auto;width:500px;height:375px;border-style:double;overflow:hidden}#videoStream{width:500px;height:375px;background-color:#000}#crosshairOverlay{position:absolute;width:100px;height:100px;left:200px;top:137.5px}</style></head><body><a href="https://www.emberprototypes.com/products/cxc" target="_blank"><img src="../images/Black Logo.png" alt="Ember background" class="center" style="max-width:400px;min-width:400px"><br><hr style="width:500px;height:5px;background-color:#e6e6e6;border-width:0"><br></a><h2 style="font-weight:1000">Camera Assisted XY Offset Calibration</h2><a href="https://drive.google.com/file/d/1kBHQkrujYlfWvHdGmklLLmi-EM_ri_2X/view" target="_blank">Click here for user manual & troubleshooting</a><br><br><br><div id="videoContainer"><video autoplay="true" id="videoStream"></video><img id="crosshairOverlay" src="../images/Crosshair.png" alt="Image crosshair"></div><br><button onclick="zoomIn()">&nbsp;&nbsp;&nbsp;Zoom In&nbsp;&nbsp;</button>&nbsp;<button onclick="zoomOut()">Zoom Out</button><br><br><button id="startButton" onclick="startHandler()" style="font-size:larger">&nbsp;&nbsp;Start&nbsp;&nbsp;</button>&nbsp;&nbsp;<button id="backButton" onclick="backHandler()" style="font-size:larger" disabled="disabled">&nbsp;&nbsp;Back&nbsp;&nbsp;</button>&nbsp;&nbsp;<button id="resetButton" onclick="resetHandler()" style="font-size:larger" disabled="disabled">&nbsp;&nbsp;Reset&nbsp;&nbsp;</button><br><br><form><p style="font-weight:600">X0: <input type="number" name="x0" id="x0" step="0.01" value="0.00" onchange="setTwoNumberDecimal(this)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y0: <input type="number" name="y0" id="y0" step="0.01" value="0.00" onchange="setTwoNumberDecimal(this)"><br><br>X1: <input type="number" name="x1" id="x1" step="0.01" value="0.00" onchange="setTwoNumberDecimal(this)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y1: <input type="number" name="y1" id="y1" step="0.01" value="0.00" onchange="setTwoNumberDecimal(this)"><br><br>X2: <input type="number" name="x2" id="x2" step="0.01" value="0.00" onchange="setTwoNumberDecimal(this)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y2: <input type="number" name="y2" id="y2" step="0.01" value="0.00" onchange="setTwoNumberDecimal(this)"><br><br>X3: <input type="number" name="x3" id="x3" step="0.01" value="0.00" onchange="setTwoNumberDecimal(this)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y3: <input type="number" name="y3" id="y3" step="0.01" value="0.00" onchange="setTwoNumberDecimal(this)"><br><br>X4: <input type="number" name="x4" id="x4" step="0.01" value="0.00" onchange="setTwoNumberDecimal(this)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y4: <input type="number" name="y4" id="y4" step="0.01" value="0.00" onchange="setTwoNumberDecimal(this)"><br></p></form><form><br><hr style="width:500px;height:5px;background-color:#e6e6e6;border-width:0"><br><p style="font-weight:600">X: <input type="text" id="calibrationX" name="calibrationX" readonly="readonly">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y: <input type="text" id="calibrationY" name="calibrationY" readonly="readonly"><br><br><br></p></form><a style="font-size:smaller" href="mailto:info@emberprototypes.com">Ember Prototypes - 2023</a>
<script>
function findCamera(deviceInfos){var cxcDeviceID=null;var video=document.querySelector("#videoStream");for(let i=0;i<deviceInfos.length;i++){const deviceInfo=deviceInfos[i];debugOutput(deviceInfo.label);debugOutput(deviceInfo.deviceId);if(deviceInfo.label.includes("HD Camera")&&!deviceInfo.label.includes("FaceTime")){cxcDeviceID=deviceInfo.deviceId;navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:cxcDeviceID}}}).then(function(stream){video.srcObject=stream})["catch"](function(videoStreamError){debugOutput("Error streaming video")});debugOutput("CXC camera connected!");break}}if(cxcDeviceID==null){debugOutput("Could not find the CXC Camera",cxcDeviceID);alert("Could not find the CXC Camera!")}}async function cameraConnect(){if(navigator.mediaDevices.getUserMedia){debugOutput("Attempting to get permissions, enumerate, and connect to CXC camera...");await navigator.mediaDevices.getUserMedia({video:true});navigator.mediaDevices.enumerateDevices().then(findCamera)["catch"](function(enumerateError){debugOutput("Error enumerating or connecting to devices")})}}function debugOutput(text){console.log(text)}function calculateOffsets(){debugOutput("Calculating offsets...");var x0=document.getElementById("x0").value;var x1=document.getElementById("x1").value;var x2=document.getElementById("x2").value;var x3=document.getElementById("x3").value;var x4=document.getElementById("x4").value;var y0=document.getElementById("y0").value;var y1=document.getElementById("y1").value;var y2=document.getElementById("y2").value;var y3=document.getElementById("y3").value;var y4=document.getElementById("y4").value;var offset_x1=(x0-x1).toFixed(2);var offset_x2=(x0-x2).toFixed(2);var offset_x3=(x0-x3).toFixed(2);var offset_x4=(x0-x4).toFixed(2);var offset_y1=(y0-y1).toFixed(2);var offset_y2=(y0-y2).toFixed(2);var offset_y3=(y0-y3).toFixed(2);var offset_y4=(y0-y4).toFixed(2);var calibrationX_results=offset_x1+" / "+offset_x2+" / "+offset_x3+" / "+offset_x4;var calibrationY_results=offset_y1+" / "+offset_y2+" / "+offset_y3+" / "+offset_y4;document.getElementById("calibrationX").value=calibrationX_results;document.getElementById("calibrationY").value=calibrationY_results;debugOutput(calibrationX_results);debugOutput(calibrationY_results)}function zoomIn(){if(currentZoomValue<3){currentZoomValue+=.5}document.getElementById("videoStream").style.transform="scale("+currentZoomValue+")"}function zoomOut(){if(currentZoomValue>1){currentZoomValue-=.5}document.getElementById("videoStream").style.transform="scale("+currentZoomValue+")"}function setTwoNumberDecimal(input){input.value=parseFloat(input.value).toFixed(2)}function startHandler(){if(currentState==0){document.getElementById("backButton").disabled=false;document.getElementById("resetButton").disabled=false;document.getElementById("startButton").innerHTML="Continue"}currentState++;stateHandler()}function backHandler(){currentState--;stateHandler()}function resetHandler(){currentState=0;stateHandler()}function stateHandler(){switch(currentState){case 0:document.getElementById("startButton").innerHTML="Start";document.getElementById("startButton").disabled=false;document.getElementById("backButton").disabled=true;document.getElementById("resetButton").disabled=true;break;case 1:alert("You MUST clear existing machine offset values for calibration to be accurate.\n\nYou MUST home the machine AFTER any changes to machine offset values.\n\nOrder of operations is CRITICAL, follow instructions carefully.\n\nEnsure your CXC is STABLE and does NOT MOVE during calibration.");break;case 2:alert("Clean nozzles - heat to 200C+ and wipe with brass/stainless brush.\n\nBackup current calibration values and then set to zero.");break;case 3:alert("Home the machine.\n\nMove the Z axis up to 30mm.");break;case 4:alert("Place the CXC on the bed and drive T0 until visible.\n\nRotate the lens to focus the camera and adjust exposure if required.");break;case 5:alert("Move T0 until centered in the crosshair.\n\nEnter the absolute X and Y position into the fields below.");break;case 6:alert("Home T0 and move T1 to the position previously recorded.");break;case 7:alert("Move T1 until centered in the crosshair.\n\nEnter the absolute X and Y position into the fields below.\n\nRepeat for remaining extruders if any.");document.getElementById("startButton").disabled=false;document.getElementById("calibrationX").value="";document.getElementById("calibrationY").value="";break;case 8:calculateOffsets();alert("CALIBRATION COMPLETE!\n\nEnter the offset values into your printer or slicer.\n\nIf you are having trouble calibrating, check our user manual for troubleshooting.");document.getElementById("startButton").disabled=true;document.getElementById("backButton").disabled=false;document.getElementById("resetButton").disabled=false;break}}var currentZoomValue=1;var currentState=0;cameraConnect();
</script>
</body></html>